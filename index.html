<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name=viewport content="width=device-width, initial-scale=1, user-scalable=no">
  
    <title>diffHTML: Easily swap out markup with an intelligent virtual dom</title>

    <link rel="stylesheet" href="prism.css">
    <link rel="stylesheet" href="codemirror.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="favorite-movies-chart.css">
    <link rel="stylesheet" href="lite-brite.css">
    <link rel="stylesheet" href="octicons.css">

    <script src="https://use.typekit.net/xze5bef.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>
  </head>
  <body>
    <aside>
        <h1><img width="20%" src="kiwi.png">diffHTML</h1>
        <a href="http://github.com/tbranyen/diffhtml" class="github">
          <span class="octicon octicon-mark-github"></span>
          <span class="text">GitHub Repository</span>
        </a>
      
      <nav>
        <h4>Basics</h4>
        <hr>
        <a href="#about">About</a>
        <a href="#installing">Installing</a>
        <a href="#prollyfill">Enabling the prollyfill</a>

        <h4>API</h4>
        <hr>
        <a href="#options">Options</a>
        <hr>
        <a href="#outer-html">outerHTML</a>
        <a href="#inner-html">innerHTML</a>
        <a href="#element">element</a>
        <a href="#add-transition-state">addTransitionState</a>
        <a href="#remove-transition-state">removeTransitionState</a>
        <a href="#register-element">registerElement</a>
        <a href="#release">release</a>

        <h5>Transitions</h5>
        <hr>
        <a href="#attached-transition">attached</a>
        <a href="#detached-transition">detached</a>
        <a href="#attribute-changed-transition">attributeChanged</a>
        <a href="#text-changed-transition">textChanged</a>

        <hr>
        <a href="#custom-elements">Custom Elements</a>
        <hr>

        <h4>Demos</h4>
        <hr>
        <a href="#live-template">Live template</a>
        <a href="#simple-bar-chart">Simple Bar Chart</a>
        <a href="#lite-brite">Lite Brite</a>
      </nav>
    </aside>

    <main>
      <p class="bump">
        <strong>diffHTML</strong> provides an easy way to swap out markup with
        an intelligent virtual dom, <i>optionally</i> exposes a Custom
        Element's polyfill, and supports transition hooks for element,
        attribute, and text modifications.  These transitions can delay future
        renders until an animation/transition Promise has resolved.
      </p>

      <h4>Useful as a library:</h4>

      <p>
        <pre class="language-javascript code"><code>diff.innerHTML(document.body, `${document.body.innerHTML}&lt;h1&gt;new markup to change&lt/h1&gt;`);</code></pre>
      </p>

      <h4>...or as a <a href="#prollyfill">prollyfill</a>:</h4>

      <pre class="language-javascript code"><code>document.body.diffInnerHTML += '&lt;h1&gt;new markup to change&lt/h1&gt;';</code></pre>

      <p> 
      Compare to <code>innerHTML</code> and <code>outerHTML</code> which do not
      recyle elements by design and instead destroy and recreate the DOM tree
      every time.
      </p>

      <hr>

      <h2 id="about">About</h2>

      <p>
        Inspired by React and motivated by the Web, this is a low-level tool which aims
        to help web developers write applications. By focusing on the markup
        representing how your application state should look, diffHTML will figure out
        how to modify the page with the fewest amount of operations.
      </p>

      <h5>Features:</h5>

      <ul>
        <li>Intelligent Virtual DOM w/ diffing and patching of HTML text and elements.</li>
        <li>Transitions API to hook into element and attribute state changes.</li>
        <li>Custom Elements in browsers without native support.</li>
        <li>Offloading diff to Web Workers which provides better rendering performance.</li>
        <li>Object pooling to avoid GC thrashing and expensive uuid generation.</li>
      </ul>

      <h2 id="installing">Installing</h2>

      <p>
        You can easily install by downloading the <a href="https://raw.githubusercontent.com/tbranyen/diffhtml/master/dist/diffhtml.js">latest prebuilt JavaScript
        distribution</a> or by using NPM:
      </p>

      <pre class="language-javascript"><code>npm install diffhtml</code></pre>

      <p>
      Distributions are committed into the repository, so you can point your
      package.json to a specific hash if you wish to lock or test a specific
      version. This is useful for testing out bug fixes or future releases.
      </p>
      
      <p>
        Example:

        <pre class="language-javascript"><code>{
  "dependencies": {
    "diffhtml": "tbranyen/diffhtml#master"
  }
}</code></pre>
      </p>

      <hr>

      <h2 id="prollyfill">Enabling the Prollyfill</h2>

      <p>
        It may look like a typo, but <a
        href="https://twitter.com/slexaxton/status/257543702124306432">prollyfill</a>
        is the intentional spelling of a cute portmanteau that Alex Sexton came
        up with to describe a polyfill for a non-existent or potentially future
        specification.
      </p>

      <p>
        Consuming diffHTML as a library is easy with any module loader or the
        global JavaScript environment, but like jQuery, could an implementation
        influence the browser standard API?  That is the question I'm hoping to
        help solve with this project. Even if this solution isn't the best one
        available, could it be "good enough" to solve a majority of the
        problems developers face building web applications?
      </p>

      <p>
        Throughout the documentation you will see mentions of prollyfill
        equivalents for the diffHTML library, when you enable this feature you
        can choose to use them instead.
      </p>

      <p>
        If you wish to try an experimental browser API, you can call the
        following code <i>*note the responsibility of calling this method
        below*</i>:
      </p>

      <pre class="language-javascript"><code>diff.enableProllyfill();</code></pre>


      <p>
        <em>Do not invoke this method from a library or plugin, this is meant
        for application developers who control the entire environment. This is a very intrusive and globally affecting method. See the disclaimer below for more information.</em>
      </p>

      <p>
        <em>
          Disclaimer: By calling this method, you are agreeing that it's okay
          for diffHTML to modify your browser's HTMLElement constructor,
          Element.prototype, the document object, and run some logic on your
          document ready event.
        </em>
      </p>

      <hr>


      <h2 id="options">Options</h2>

      <p>
        This is the main documentation for the available options that can be
        passed to diffHTML. They are entirely optional. 
      </p>

      <ul>
        <li>
          <strong>enableWorker</strong> <i class="type">Boolean</i> Enable a Worker to process the patches
          for this element.
          
          <pre class="language-javascript"><code>diff.outerHTML(document.body, `&lt;body&gt;&lt;/body&gt;`, {
  enableWorker: true
});</code></pre>

          <a href="#prollyfill" class="polyfill-equiv">
            <strong>Prollyfill:</strong> <code>document.ENABLE_WORKER = true;</code>
          </a>

          <p>
            <u>Please note:</u> This is an experimental feature that may or may
            not work perfectly for you.
          </p>
          <p>
            Since it can be enabled on a per-component basis, it may make sense
            to opt-in for some high performance chart or grid, while
            re-rendering the entire page is done on the UI thread to avoid
            potential race conditions.
          </p>
        </li>

        <li>
          <strong>inner</strong> <i class="type">Boolean</i> Used when diffing
          against another element, this option allows you to specify if you're
          comparing the children of an element or the actual element itself.

          <pre class="lang-javascript"><code>diff.element(document.body, newBodyChildren, {
  inner: true
});</code></pre>

          <a href="#prollyfill" class="polyfill-equiv">
            <strong>Prollyfill:</strong> <code>document.body.diffElement(newBodyChildren, {
  inner: true
});</code>
          </a>


        </li>
      </ul>

      <hr>

      <h2 id="outer-html">outerHTML<span class="args">(element, markup, <a href="#options">[options]</a>)</span></h2>

      <a href="#prollyfill" class="polyfill-equiv">
        <strong>Prollyfill:</strong> <code>HTMLElement.prototype.diffOuterHTML = markup;</code>
      </a>

      This method diffs an element, including its own tag with markup. Both the
      element and the markup arguments are required, although the options
      argument is completely optional.

      <p>
        This method will take in a string of markup that matches the element root you
        are diffing against.  This allows you to change attributes and text on the
        main element.  This also allows you to change the <code>document.documentElement</code>.
      </p>

      <p>
      An example below shows how you could set the page state using markup
      representing the entire page:
      </p>

      <pre class="language-javascript"><code>
import diff from 'diffhtml';

diff.outerHTML(document.documentElement, `
  &lt;html&gt;
    &lt;head&gt;
      &lt;title&gt;New Title&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Hello world!&lt;/h1&gt;
    &lt;/body&gt;
  &lt;/html&gt;
`);
      </code></pre>

      <p>
      Not all uses of <code>outerHTML</code> involve the entire page, you may
      want to use on a single element when writing a Custom Element class.
      </p>

      <pre class="language-javascript"><code>
import diff from 'diffhtml';

class MyCustomElement extends HTMLElement {
  attachedCallback() {
    this.render();
  }

  render() {
    diff.outerHTML(this, `
      &lt;my-custom-element&gt;
        &lt;h1&gt;${this.msg}&lt;/h1&gt;
      &lt;/my-custom-element&gt;
    `)
  }
}

document.registerElement('my-custom-element', MyCustomElement);
      </code></pre>

      <hr>

      <h2 id="inner-html">innerHTML<span class="args">(element, markup, <a href="#options">[options]</a>)</span></h2>

      <a href="#prollyfill" class="polyfill-equiv">
        <strong>Prollyfill:</strong> <code>HTMLElement.prototype.diffInnerHTML = markup;</code>
      </a>

      <p>
        This method diffs an element's children with markup, but it's own
        attribute changes are ignored.
      </p>

      <pre class="language-javascript"><code>
import diff from 'diffhtml';

var div = document.createElement('div');

diff.innerHTML(div, `
  &lt;p&gt;Hello world&lt;/p&gt;
`);

console.log(div.firstChild.nodeName); // logs out P 
      </code></pre>

      <hr>

      <h2 id="element">element<span class="args">(element, newElement, <a href="#options">[options]</a>)</span></h2>

      <a href="#prollyfill" class="polyfill-equiv">
        <strong>Prollyfill:</strong> <code>HTMLElement.prototype.diffElement(newElement, [options]);</code>
      </a>

      <pre class="language-javascript"><code>
// Bring in the library using ES6.
import diff from 'diffhtml';

// Create the fixture elements.
var oldDiv = document.createElement('div');
var newDiv = document.createElement('div');

// Add in a paragraph tag to newDiv with the `textContent` set to 'Hello world'
var newP = document.createElement('p');
newP.appendChild(document.createTextNode('Hello world'));

// Add this into the newDiv.
newDiv.appendChild(newP);

// Diff + patch the oldDiv with the newDiv.
diff.element(oldDiv, newDiv);

console.log(div.firstChild.nodeName); // logs out P</code></pre>

      <hr>

      <h2 id="add-transition-state">addTransitionState<span class="args">(stateName, callback)</span></h2>

      <a href="#prollyfill" class="polyfill-equiv">
        <strong>Prollyfill:</strong> <code>document.addTransitionState('attached', attachedFn);</code>
      </a>

      <hr>

      <h2 id="remove-transition-state">removeTransitionState<span class="args">([stateName], [callback])</span></h2>

      <a href="#prollyfill" class="polyfill-equiv">
        <strong>Prollyfill:</strong> <code>document.removeTransitionState('attached', attachedFn);</code>
      </a>

      <hr>

      <h2 id="attached-transition">Attached transition</h2>
      <hr>

      <h4>TBD</h4>

      <h2 id="detached-transition">Detached transition</h2>
      <hr>

      <h4>TBD</h4>

      <h2 id="attribute-changed-transition">Attribute changed transition</h2>
      <hr>

      <h4>TBD</h4>

      <h2 id="text-changed-transition">Text changed transition</h2>
      <hr>

      <h4>TBD</h4>

      <hr>

      <h2 id="custom-elements">Custom Elements</h2>

      <p>
        <em>"Web Components"</em> is an umbrella term for a various set
        of specifications that are geared towards authoring new HTML elements.
        <em>Custom Elements</em> are one of these specifications that are
        implemented partially or in full by various evergreen browsers. They
        allow a developer to pick a new HTML element name (that must contain a
        dash) and register a class containing lifecyle methods.
      </p>
      <p>
        This is quite sufficient for building progressively enhanceable
        applications.  diffHTML will attempt to polyfill all the major popular
        browsers with support, so you can use the raw ES6 class form extending
        <code>HTMLElement</code>:
      </p>

      <pre class="lang-javascript"><code>
class CustomElement extends HTMLElement {
  createdCallback() {
    console.log('diffHTML or your browser has created the element');
  }

  attachedCallback() {
    console.log('The element is in the DOM');
  }

  detachedCallback() {
    console.log('The element has left the DOM');
  }

  attributeChangedCallback(attributeName, oldValue, newValue) {
    console.log('An attribute has changed on the element');
  }
  
  textChangedCallback(oldValue, newValue) {
    console.log('Only available with diffHTML, would be nice in the specification');
  }
}
      </code></pre>

      <p>
        Whenever you initialize a DOM plugin or bind any kind of event in your
        created/attached callbacks you must unbind in your detached callback.
      </p>

      <hr>

      <h2 id="live-template">Live template</h2>

      <p>
        Update the markup and JSON data below and the output will re-render
        automatically.
      </p>

      <div class="example">
        <div class="demo" style="clear: both;">
          <pre class="language-handlebars editor"></pre>
          <pre class="language-javascript json"></pre> 

          <output></output>

          <button class="run-animation">Run animation</button>
        </div>
      </div>

      <hr>

      <h2 id="simple-bar-chart">Simple Bar Chart</h2>

      <button class="re-render">Randomize and re-render the chart</button>

      <favorite-movies-chart width="100%" count="10"></favorite-movies-chart>

      <hr>

      <h2 id="lite-brite">Lite Brite</h2>

      <strong class="board-label">Choose a peg color: </strong>
      <input type="color" value="#FF217D" id="lite-brite-color">

      <div class="board">
        <div id="backgrounds"></div>

        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
        <lite-brite></lite-brite>
      </div>

      <hr>

      <script src="combyne.js"></script>
      <script src="prism.js"></script>
      <script src="codemirror.js"></script>
      <script src="mustache.js"></script>
      <script src="diffhtml.js"></script>
      <script src="docs-es5.js"></script>
      <script src="favorite-movies-chart.js"></script>
      <script src="randomColor.js"></script>
      <script src="lite-brite.js"></script>

      <footer>
        <p>MIT License 2016, Tim Branyen (<a href="https://twitter.com/tbranyen">@tbranyen</a>)</p>
      </footer>
    </main>
  </body>
</html>
